# SPDX-License-Identifier: Apache-2.0
---

# loop block for pre_install/assert_inifile_vars.yml

- name: SAP SWPM Pre Install - Assert variable {{ __sap_swpm_var_name }} for 'two_digit_number'
  ansible.builtin.assert:
    that:
      - lookup('ansible.builtin.vars', __sap_swpm_var_name, default='SAP_SWPM_UNDEFINED_VARIABLE_DETECTED') != 'SAP_SWPM_UNDEFINED_VARIABLE_DETECTED'
      - (lookup('ansible.builtin.vars', __sap_swpm_var_name) | trim) is ansible.builtin.regex('^\\d{2}$')
    success_msg: |
      PASS: The variable '{{ __sap_swpm_var_name }}' used in section '{{ __sap_swpm_var_section }}' is valid.
    fail_msg: |
      {% if lookup('ansible.builtin.vars', __sap_swpm_var_name, default='SAP_SWPM_UNDEFINED_VARIABLE_DETECTED') == 'SAP_SWPM_UNDEFINED_VARIABLE_DETECTED' %}
        FAIL: The variable '{{ __sap_swpm_var_name }}' used in section '{{ __sap_swpm_var_section }}' is undefined.
      {% elif lookup('ansible.builtin.vars', __sap_swpm_var_name) | string | trim | length == 0 %}
        FAIL: The variable '{{ __sap_swpm_var_name }}' used in section '{{ __sap_swpm_var_section }}' is empty.
      {% else %}
        FAIL: The variable '{{ __sap_swpm_var_name }}' used in section '{{ __sap_swpm_var_section }}' is not a double digit number.
        The value can be defined as a String or Integer between 00 and 99.
      {% endif %}
  vars:
    __sap_swpm_var_name: "{{ __sap_swpm_vars_to_be_asserted_for_number_line_item.name }}"
    __sap_swpm_var_section: "{{ __sap_swpm_vars_to_be_asserted_for_number_line_item.section }}"
  when:
    - __sap_swpm_var_section in sap_swpm_inifile_sections_list
